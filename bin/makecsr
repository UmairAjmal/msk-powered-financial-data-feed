#!/bin/bash
# makecsr - Make a private key file and CSR (Certificate Signing Request)
#
# Outputs a private_key.pem file, a client_cert.csr file and a truststore.pem file
#
cacerts_file=`find /usr/lib/jvm -name cacerts -print`
keystore_file=kafka.client.keystore.jks
truststore_jks=kafka.client.truststore.jks
truststore_pkcs=truststore.p12
private_key_file=private_key.pem
csr_file=client_cert.csr

if [ -z "cacerts_file" ]
then
        echo "Java is not installed. To install Java: $ yum -y install java-1.8.0"
        exit 1
fi
openssl genrsa -out $private_key_file 2048
openssl req -new -sha256 -key $private_key_file -out $csr_file
# Make the truststore file
cp $cacerts_file $truststore_jks
keytool -importkeystore -srckeystore  $truststore_jks -srcstorepass changeit -destkeystore $truststore_pkcs -srcstoretype jks -deststoretype pkcs12
openssl pkcs12 -in $truststore_pkcs -out truststore.pem
rm -f $truststore_pkcs

