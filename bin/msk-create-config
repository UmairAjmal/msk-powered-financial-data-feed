#!/bin/bash
#
# msk-create-config - Create an MSK configuration and output the ARN
#

if ! command -v jq &> /dev/null; then
    echo "jq command is not installed"
    exit 1
fi

if [ ! -f ./msk-config.txt ]; then
    echo "msk-config.txt not found. Are you in the right directory?"
    exit 1 
fi

arn_file="msk-config-arn.txt"
if [ ! -f $arn_file ]; then
    config_file=$(readlink -f ./msk-config.txt)
    tmpfile="$(mktemp)"
    aws kafka create-configuration --name "msk-feed-config" --server-properties fileb://$config_file > $tmpfile
    config_arn=`jq '.["Arn"]' $tmpfile`
    rm -f $tmpfile
    echo $config_arn > $arn_file
fi
